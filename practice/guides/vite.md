# Vite — учебник для проекта

## Зачем это читать
Vite — это сборщик и dev‑сервер для современных веб‑проектов. Он дает быстрый запуск разработки, горячие обновления модулей и сборку production‑версии. Этот документ объясняет, как Vite работает, какие части он берет на себя в нашем проекте, и как правильно организовать рабочий цикл.

## Что такое Vite
Vite состоит из двух частей:
- Dev‑сервер с поддержкой современных ES‑модулей и быстрым HMR.
- Команда сборки, которая собирает оптимизированные статические файлы для продакшена.

Ключевая идея: в dev‑режиме Vite не «собирает все заранее», а отдает модули по запросу браузера. Поэтому разработка ощущается быстрее.

## Роль Vite в этом проекте
- Запуск dev‑сервера для локальной разработки.
- Обработка `index.html` как точки входа.
- Подключение `src/main.js` и всех импортов.
- Компиляция Sass в CSS (через установленный Sass‑препроцессор).
- Сборка production‑версии и локальный предпросмотр.

Связанные файлы:
- `index.html` — точка входа приложения.
- `src/main.js` — основной JS‑модуль.
- `src/styles/main.scss` — главный файл стилей.
- `vite.config.js` — конфигурация Vite (если требуется).

## Как Vite видит проект
### `index.html` как входная точка
В Vite `index.html` — это часть исходного кода и стартовая точка приложения. Vite парсит `index.html`, находит `<script type="module" src="...">` и строит модульный граф оттуда.

Это важно:
- `index.html` лежит в корне проекта и служит entry‑point.
- Внутри `index.html` можно подключать модули и стили обычными путями, Vite их обработает.

Пример:
```html
<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
```

## Основные команды
В проектах на Vite обычно используются такие команды:
```bash
npm run dev
npm run build
npm run preview
```

Что они означают:
- `dev` — запуск dev‑сервера.
- `build` — production‑сборка.
- `preview` — локальный просмотр собранной версии.

В нашем проекте то же самое можно запускать через Yarn:
```bash
yarn dev
yarn build
yarn preview
```

## Что происходит при `dev`
- Vite поднимает dev‑сервер и начинает обслуживать `index.html`.
- По цепочке импортов подключается `src/main.js`.
- Все изменения в JS и CSS обновляются через HMR без перезагрузки страницы.

Dev‑сервер обычно работает на `http://localhost:5173` по умолчанию, если порт не занят.

## Что происходит при `build`
- Запускается `vite build`.
- Vite использует `index.html` как точку входа и собирает оптимизированный набор статических файлов для продакшена.

Результат — готовый к деплою набор файлов.

## CSS и Sass в Vite
### Подключение CSS
Если вы импортируете CSS‑файл из JS, Vite автоматически добавит стили в страницу и будет обновлять их через HMR.

Пример:
```js
import './styles/main.scss'
```

### Поддержка Sass
Vite поддерживает `.scss` и `.sass` из коробки. Не нужны специальные плагины Vite, но нужен установленный Sass‑препроцессор.

Установка:
```bash
npm install -D sass
```

В этом проекте Sass уже добавлен как dev‑зависимость.

### Где это видно в проекте
- `src/styles/main.scss` импортируется в `src/main.js`.
- Vite компилирует Sass в CSS и автоматически внедряет в страницу.

## Работа с ассетами (изображения, шрифты)
### Импорт файлов как URL
Если вы импортируете файл, Vite вернет URL, который корректно работает и в dev‑режиме, и после сборки.

Пример:
```js
import heroUrl from './assets/hero.png'
const img = document.querySelector('#hero')
img.src = heroUrl
```

### Папка `public`
Если ассет нельзя импортировать (например, `robots.txt` или файл должен сохранять имя), его кладут в `public`. Тогда он будет доступен по абсолютному пути и попадет в сборку как есть.

Пример:
```html
<img src="/logo.svg" alt="Logo" />
```

## Переменные окружения и режимы
### Доступ к env‑переменным
Vite дает доступ к переменным через `import.meta.env`. В клиентском коде доступны только переменные с префиксом `VITE_`.

Пример:
```env
VITE_API_URL=https://example.com
DB_PASSWORD=secret
```

```js
console.log(import.meta.env.VITE_API_URL)
// DB_PASSWORD не попадет в клиентский код
```

### `.env` файлы
Vite загружает переменные из таких файлов:
- `.env`
- `.env.local`
- `.env.[mode]`
- `.env.[mode].local`

Файлы `.env.*.local` предназначены для локальных секретов и должны быть исключены из git.

### Режимы
По умолчанию:
- `dev` запускается в режиме `development`.
- `build` запускается в режиме `production`.

Режим можно переопределить флагом `--mode`.

## Типовые ошибки
- Открытие `index.html` напрямую без dev‑сервера.
- Отсутствие установленного Sass при работе со стилями `.scss`.
- Переменные без префикса `VITE_` не видны в клиентском коде.
- Ассеты в `public` подключены относительным путем (должен быть абсолютный путь от `/`).

## Мини‑практикум
1. Запусти `yarn dev` и убедись, что приложение открылось в браузере.
2. Добавь в `src/main.js` импорт нового SCSS‑файла и проверь HMR.
3. Перенеси одну картинку в `public` и подключи ее по пути `/img.png`.
4. Создай `.env.local` с переменной `VITE_APP_TITLE` и выведи ее в интерфейсе.
5. Собери проект `yarn build` и запусти `yarn preview`.

## Чеклист готовности
- `index.html` используется как входная точка.
- `yarn dev` запускает dev‑сервер.
- Sass компилируется без ошибок.
- Переменные `VITE_*` доступны через `import.meta.env`.
- Сборка `yarn build` проходит успешно.

## Полезные ссылки
- https://vite.dev/guide/
- https://vite.dev/guide/build.html
- https://vite.dev/guide/features.html
- https://vite.dev/guide/assets.html
- https://vite.dev/guide/env-and-mode.html
- https://github.com/vitejs/vite
